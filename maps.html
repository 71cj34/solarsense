<!DOCTYPE html>
<html>
<head>
    <title>Geocoding Service</title>
    <script>
        let map;
        let marker;
        let geocoder;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 8,
                center: { lat: -34.397, lng: 150.644 },
                mapTypeControl: false,
            });
            geocoder = new google.maps.Geocoder();

            const inputText = document.createElement("input");
            inputText.type = "text";
            inputText.placeholder = "Enter a location";
            inputText.id = "mapInput";

            const submitButton = document.createElement("input");
            submitButton.type = "button";
            submitButton.value = "Geocode";
            submitButton.classList.add("button", "button-primary");
            submitButton.id = "mapSubmit";

            map.controls[google.maps.ControlPosition.TOP_LEFT].push(inputText);
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(submitButton);

            marker = new google.maps.Marker({ map });

            submitButton.addEventListener("click", () => geocode({ address: inputText.value }));
            map.addListener("click", (e) => geocode({ location: e.latLng }));

            window.addEventListener("message", function(event) {
                if (event.data.type === "SET_INPUT_VALUE") {
                    inputText.value = event.data.value;
                    submitButton.click(); // Automatically trigger Geocode
                }
            });
        }

        function geocode(request) {
            geocoder
                .geocode(request)
                .then((result) => {
                    const { results } = result;
                    map.setCenter(results[0].geometry.location);
                    marker.setPosition(results[0].geometry.location);
                    marker.setMap(map);
                    console.log(
                        results[0].geometry.location.lat(),
                        results[0].geometry.location.lng()
                    );
                })
                .catch((e) => {
                    alert("Geocode was not successful: " + e);
                });
        }

        window.initMap = initMap;
    </script>
    <style>
        #map {
            height: 100%;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbPVtRSzC2H_bw5veu3NOjQXBEi4OsKhc&callback=initMap&v=weekly"
        defer
    ></script>
</body>
</html>
